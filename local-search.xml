<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>NodeJSçš„å®šæ—¶ä»»åŠ¡</title>
    <link href="/2023/01/26/NodeJS%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/01/26/NodeJS%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="NodeJSçš„å®šæ—¶ä»»åŠ¡"><a href="#NodeJSçš„å®šæ—¶ä»»åŠ¡" class="headerlink" title="NodeJSçš„å®šæ—¶ä»»åŠ¡"></a>NodeJSçš„å®šæ—¶ä»»åŠ¡</h1><h3 id="ä½¿ç”¨node-scheduleåº“"><a href="#ä½¿ç”¨node-scheduleåº“" class="headerlink" title="ä½¿ç”¨node-scheduleåº“"></a>ä½¿ç”¨node-scheduleåº“</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">npm install node-schedule<br></code></pre></td></tr></table></figure><p>Node Schedule ä¸­çš„æ¯ä¸ªå®šæ—¶ä»»åŠ¡éƒ½ç”±ä¸€ä¸ª<code>Job</code>å¯¹è±¡è¡¨ç¤ºã€‚å¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼Œç„¶åæ‰§è¡Œ<code>schedule()</code>æ–¹æ³•ä»¥åº”ç”¨ä»»åŠ¡ï¼Œæˆ–ä½¿ç”¨<code>scheduleJob()</code>å¦‚ä¸‹ã€‚</p><p><code>Job</code>å¯¹è±¡æ˜¯`EventEmitterï¼Œå¹¶å‘å‡ºä»¥ä¸‹äº‹ä»¶ï¼š</p><ul><li><code>run</code>æ¯æ¬¡æ‰§è¡Œåçš„äº‹ä»¶ã€‚</li><li><code>scheduled</code>æ¯æ¬¡è®¡åˆ’è¿è¡Œæ—¶çš„äº‹ä»¶ã€‚</li><li>ä¸€<code>canceled</code>ï¼Œå½“å®ƒåœ¨æ‰§è¡Œä¹‹å‰è°ƒç”¨è¢«å–æ¶ˆçš„äº‹ä»¶ã€‚</li><li>ä¸€ä¸ª<code>error</code>å½“è¢«è§¦å‘è°ƒåº¦ä½œä¸šè°ƒç”¨æŠ›å‡ºæˆ–é€€å‡ºäº‹ä»¶æ‹’ç»<code>Promise</code>ã€‚</li></ul><p>ï¼ˆ<code>scheduled</code>å’Œ<code>canceled</code>äº‹ä»¶éƒ½æ¥æ”¶ä¸€ä¸ª JavaScript æ—¥æœŸå¯¹è±¡ä½œä¸ºå‚æ•°ï¼‰ã€‚ æ³¨æ„çš„æ˜¯ï¼Œä»»åŠ¡æ˜¯ç¬¬ä¸€æ¬¡ç«‹å³æ‰§è¡Œçš„ï¼Œå› æ­¤å¦‚æœä½¿ç”¨<code>scheduleJob()</code>æ–¹æ³•åˆ›å»ºä»»åŠ¡ï¼Œå°†é”™è¿‡ç¬¬ä¸€ä¸ª<code>scheduled</code>Â äº‹ä»¶è§¦å‘ï¼Œä½†æ‚¨å¯ä»¥æ‰‹åŠ¨æŸ¥è¯¢è°ƒç”¨ã€‚</p><h3 id="Cronæ ¼å¼"><a href="#Cronæ ¼å¼" class="headerlink" title="Cronæ ¼å¼"></a><strong>Cronæ ¼å¼</strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx">*    *    *    *    *    *<br>â”¬    â”¬    â”¬    â”¬    â”¬    â”¬<br>â”‚    â”‚    â”‚    â”‚    â”‚    â”‚<br>â”‚    â”‚    â”‚    â”‚    â”‚    â”” day <span class="hljs-keyword">of</span> week (<span class="hljs-number">0</span> - <span class="hljs-number">7</span>) (<span class="hljs-number">0</span> or <span class="hljs-number">7</span> is <span class="hljs-title class_">Sun</span>)<br>â”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€ month (<span class="hljs-number">1</span> - <span class="hljs-number">12</span>)<br>â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day <span class="hljs-keyword">of</span> month (<span class="hljs-number">1</span> - <span class="hljs-number">31</span>)<br>â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (<span class="hljs-number">0</span> - <span class="hljs-number">23</span>)<br>â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (<span class="hljs-number">0</span> - <span class="hljs-number">59</span>)<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ second (<span class="hljs-number">0</span> - <span class="hljs-number">59</span>, <span class="hljs-variable constant_">OPTIONAL</span>)<br><br>æ¯åˆ†é’Ÿçš„ç¬¬<span class="hljs-number">30</span>ç§’è§¦å‘ï¼š <span class="hljs-string">&#x27;30 * * * * *&#x27;</span><br><br>æ¯å°æ—¶çš„<span class="hljs-number">1</span>åˆ†<span class="hljs-number">30</span>ç§’è§¦å‘ ï¼š<span class="hljs-string">&#x27;30 1 * * * *&#x27;</span><br><br>æ¯å¤©çš„å‡Œæ™¨<span class="hljs-number">1</span>ç‚¹<span class="hljs-number">1</span>åˆ†<span class="hljs-number">30</span>ç§’è§¦å‘ ï¼š<span class="hljs-string">&#x27;30 1 1 * * *&#x27;</span><br><br>æ¯æœˆçš„<span class="hljs-number">1</span>æ—¥<span class="hljs-number">1</span>ç‚¹<span class="hljs-number">1</span>åˆ†<span class="hljs-number">30</span>ç§’è§¦å‘ ï¼š<span class="hljs-string">&#x27;30 1 1 1 * *&#x27;</span><br><br><span class="hljs-number">2016</span>å¹´çš„<span class="hljs-number">1</span>æœˆ<span class="hljs-number">1</span>æ—¥<span class="hljs-number">1</span>ç‚¹<span class="hljs-number">1</span>åˆ†<span class="hljs-number">30</span>ç§’è§¦å‘ ï¼š<span class="hljs-string">&#x27;30 1 1 1 2016 *&#x27;</span><br><br>æ¯å‘¨<span class="hljs-number">1</span>çš„<span class="hljs-number">1</span>ç‚¹<span class="hljs-number">1</span>åˆ†<span class="hljs-number">30</span>ç§’è§¦å‘ ï¼š<span class="hljs-string">&#x27;30 1 1 * * 1&#x27;</span><br></code></pre></td></tr></table></figure><p>ğŸ¤¨<strong>è¿™é‡Œæ˜¯ä¸ªäººå¯¹node-scheduleå°è£…ç±»æ¥ä½¿ç”¨å¢åˆ æ”¹æŸ¥å®šæ—¶ä»»åŠ¡</strong></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> schedule = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node-schedule&#x27;</span>);<br><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">Interval</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Interval</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">&#123; unit_name, maintain_time, last_alarm &#125;</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">unit_name</span> = unit_name          <span class="hljs-comment">// ä»»åŠ¡åå­—</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maintain_time</span> = maintain_time  <span class="hljs-comment">// å®šæ—¶æ—¶é—´</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">last_alarm</span> = last_alarm || <span class="hljs-string">&quot;&quot;</span>        <span class="hljs-comment">// ä¸Šä¸€æ¬¡å®šæ—¶ä»»åŠ¡åå­—</span><br>  &#125;<br><br>  <span class="hljs-comment">// ç”Ÿæˆæ–°çš„å®šæ—¶ä»»åŠ¡</span><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">callback</span>) &#123;<br>    <span class="hljs-comment">// ç»ˆæ­¢ä¹‹å‰çš„å®šæ—¶ä»»åŠ¡</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">last_alarm</span> !== <span class="hljs-string">&quot;&quot;</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">last_alarm</span>)<br>    &#125;<br>    schedule.<span class="hljs-title function_">scheduleJob</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.unit_name&#125;</span>`</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.maintain_time&#125;</span>`</span>, callback);<br>  &#125;<br><br>  <span class="hljs-comment">// åˆ é™¤å®šæ—¶ä»»åŠ¡</span><br>  <span class="hljs-title function_">delete</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (schedule.<span class="hljs-property">scheduledJobs</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">unit_name</span>]) &#123;<br>      schedule.<span class="hljs-property">scheduledJobs</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">unit_name</span>].<span class="hljs-title function_">cancel</span>();<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br><br>  <span class="hljs-comment">// æ‰¾åˆ°ä¸€ä¸ªå®šæ—¶ä»»åŠ¡</span><br>  <span class="hljs-title function_">findOne</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-keyword">if</span> (schedule.<span class="hljs-property">scheduledJobs</span>[name]) &#123;<br>      <span class="hljs-keyword">return</span> schedule.<span class="hljs-property">scheduledJobs</span>[name]<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;æœªæ‰¾åˆ°ä»»åŠ¡å&quot;</span>)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// æŸ¥çœ‹æ‰€æœ‰çš„å®šæ—¶ä»»åŠ¡</span><br>  <span class="hljs-title function_">findAll</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> schedule.<span class="hljs-property">scheduledJobs</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿™é‡Œæ˜¯è°ƒç”¨æ—¶å®šæ—¶ä»»åŠ¡Intervalå®ä¾‹"><a href="#è¿™é‡Œæ˜¯è°ƒç”¨æ—¶å®šæ—¶ä»»åŠ¡Intervalå®ä¾‹" class="headerlink" title="è¿™é‡Œæ˜¯è°ƒç”¨æ—¶å®šæ—¶ä»»åŠ¡Intervalå®ä¾‹"></a><strong>è¿™é‡Œæ˜¯è°ƒç”¨æ—¶å®šæ—¶ä»»åŠ¡Intervalå®ä¾‹</strong></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// å®šæ—¶ä»»åŠ¡</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Util</span>.<span class="hljs-title class_">Interval</span>(&#123;<br>  <span class="hljs-attr">unit_name</span>: <span class="hljs-string">&#x27;è‡ªåŠ¨åˆ†å‘ä»»åŠ¡ 0 0 12 * * *&#x27;</span>,<br>  <span class="hljs-attr">maintain_time</span>: <span class="hljs-string">&#x27;0 0 12 * * *&#x27;</span>,<br>  <span class="hljs-attr">last_alarm</span>: <span class="hljs-string">&#x27;è‡ªåŠ¨åˆ†å‘ä»»åŠ¡ 0 0 12 * * *&#x27;</span><br>&#125;).<span class="hljs-title function_">create</span>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-comment">// å†™å…¥ä½ è‡ªå·±æƒ³åœ¨å®šæ—¶ä»»åŠ¡è§¦å‘çš„æ—¶å€™ï¼Œæƒ³è¦æ‰§è¡Œçš„å‡½æ•°</span><br>&#125;)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
